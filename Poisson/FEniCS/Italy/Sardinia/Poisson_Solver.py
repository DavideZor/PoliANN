from fenics import * 
from mshr import *
import pylab as plt

f = Constant(1.0)

g_D = Constant(0.0)

degree = 1 #Linear finite elements

resolution = 100

domain_vertices = [Point(17.091, 77.565), Point(17.081, 77.58800000000001), Point(17.079, 77.609), Point(17.073, 77.62299999999999), Point(17.049, 77.628), Point(17.037, 77.635), Point(17.028, 77.653), Point(17.023, 77.676), Point(17.014000000000003, 77.819), Point(17.007, 77.849), Point(16.954, 77.957), Point(16.948, 77.999), Point(16.936999999999998, 78.03099999999999), Point(16.887, 78.098), Point(16.877, 78.128), Point(16.875, 78.102), Point(16.855999999999998, 78.12400000000001), Point(16.863, 78.145), Point(16.885, 78.157), Point(16.912, 78.149), Point(16.912, 78.164), Point(16.897000000000002, 78.193), Point(16.914, 78.208), Point(16.972, 78.228), Point(16.949, 78.233), Point(16.929, 78.24), Point(16.912, 78.253), Point(16.900000000000002, 78.27499999999999), Point(16.88, 78.25999999999999), Point(16.866, 78.259), Point(16.855999999999998, 78.27199999999999), Point(16.853, 78.3), Point(16.843, 78.30799999999999), Point(16.78, 78.34), Point(16.78, 78.354), Point(16.797, 78.357), Point(16.81, 78.366), Point(16.82, 78.38199999999999), Point(16.829, 78.403), Point(16.794999999999998, 78.41), Point(16.769000000000002, 78.396), Point(16.743, 78.378), Point(16.708000000000002, 78.36999999999999), Point(16.698, 78.375), Point(16.667, 78.39500000000001), Point(16.649, 78.403), Point(16.631, 78.4), Point(16.616, 78.39), Point(16.602, 78.39), Point(16.588, 78.417), Point(16.603, 78.42), Point(16.6, 78.423), Point(16.601, 78.434), Point(16.681, 78.427), Point(16.705000000000002, 78.43599999999999), Point(16.697, 78.468), Point(16.718, 78.498), Point(16.725, 78.53999999999999), Point(16.733, 78.577), Point(16.763, 78.592), Point(16.789, 78.583), Point(16.817999999999998, 78.569), Point(16.845, 78.566), Point(16.864, 78.592), Point(16.832, 78.613), Point(16.783, 78.632), Point(16.733999999999998, 78.634), Point(16.708000000000002, 78.608), Point(16.7, 78.608), Point(16.695, 78.61200000000001), Point(16.685, 78.62400000000001), Point(16.682, 78.618), Point(16.683, 78.61200000000001), Point(16.681, 78.608), Point(16.673, 78.608), Point(16.681, 78.644), Point(16.675, 78.666), Point(16.656000000000002, 78.672), Point(16.624, 78.657), Point(16.637, 78.62400000000001), Point(16.601, 78.62400000000001), Point(16.618, 78.66), Point(16.649, 78.79899999999999), Point(16.652, 78.788), Point(16.657, 78.777), Point(16.661, 78.766), Point(16.679, 78.79), Point(16.689, 78.81099999999999), Point(16.694, 78.834), Point(16.697, 78.863), Point(16.691, 78.867), Point(16.688, 78.867), Point(16.686999999999998, 78.86800000000001), Point(16.685, 78.878), Point(16.673, 78.878), Point(16.661, 78.866), Point(16.652, 78.87100000000001), Point(16.641000000000002, 78.88300000000001), Point(16.624, 78.89399999999999), Point(16.637, 78.911), Point(16.622, 78.93299999999999), Point(16.613, 78.93), Point(16.605, 78.919), Point(16.595, 78.911), Point(16.570999999999998, 78.916), Point(16.548, 78.923), Point(16.527, 78.925), Point(16.505, 78.911), Point(16.515, 78.905), Point(16.520000000000003, 78.89699999999999), Point(16.523, 78.889), Point(16.528000000000002, 78.878), Point(16.512, 78.865), Point(16.500999999999998, 78.845), Point(16.481, 78.79899999999999), Point(16.470000000000002, 78.853), Point(16.471, 78.877), Point(16.481, 78.89399999999999), Point(16.463, 78.912), Point(16.453, 78.932), Point(16.441, 78.949), Point(16.421, 78.957), Point(16.427, 78.967), Point(16.431, 78.976), Point(16.436, 78.983), Point(16.445, 78.99000000000001), Point(16.445, 79.00500000000001), Point(16.428, 79.00500000000001), Point(16.413, 79.007), Point(16.400000000000002, 79.012), Point(16.384999999999998, 79.021), Point(16.384999999999998, 79.00500000000001), Point(16.322, 79.066), Point(16.293, 79.077), Point(16.289, 79.021), Point(16.259999999999998, 79.041), Point(16.253, 79.052), Point(16.241, 79.045), Point(16.231, 79.041), Point(16.206, 79.038), Point(16.206, 79.052), Point(16.211000000000002, 79.063), Point(16.213, 79.07), Point(16.206, 79.10000000000001), Point(16.194, 79.10000000000001), Point(16.188, 79.078), Point(16.186, 79.061), Point(16.187, 79.048), Point(16.194, 79.038), Point(16.175, 79.054), Point(16.176, 79.135), Point(16.158, 79.16499999999999), Point(16.139, 79.16), Point(16.124, 79.163), Point(16.114, 79.174), Point(16.111, 79.19500000000001), Point(16.079, 79.179), Point(16.039, 79.168), Point(16.006999999999998, 79.149), Point(15.992, 79.108), Point(15.992999999999999, 79.013), Point(15.983, 78.977), Point(15.956000000000001, 78.94), Point(15.945, 78.957), Point(15.895999999999999, 78.90899999999999), Point(15.870000000000001, 78.899), Point(15.751000000000001, 78.885), Point(15.717999999999998, 78.86800000000001), Point(15.692, 78.812), Point(15.665999999999999, 78.778), Point(15.636, 78.74799999999999), Point(15.614, 78.73599999999999), Point(15.603, 78.728), Point(15.584999999999999, 78.687), Point(15.573, 78.671), Point(15.556000000000001, 78.66199999999999), Point(15.5, 78.641), Point(15.508, 78.637), Point(15.509, 78.635), Point(15.509, 78.633), Point(15.512, 78.62400000000001), Point(15.49, 78.605), Point(15.428, 78.498), Point(15.398, 78.46499999999999), Point(15.296999999999999, 78.387), Point(15.274, 78.399), Point(15.244, 78.404), Point(15.2, 78.403), Point(15.081, 78.347), Point(15.07, 78.313), Point(15.042, 78.277), Point(15.007000000000001, 78.247), Point(14.871, 78.187), Point(14.837, 78.181), Point(14.796999999999999, 78.185), Point(14.699000000000002, 78.214), Point(14.504, 78.241), Point(14.448, 78.27499999999999), Point(14.37, 78.379), Point(14.363000000000001, 78.405), Point(14.366999999999999, 78.435), Point(14.374, 78.46300000000001), Point(14.374999999999998, 78.482), Point(14.362, 78.5), Point(14.346999999999998, 78.499), Point(14.334, 78.50200000000001), Point(14.329, 78.52900000000001), Point(14.315, 78.52900000000001), Point(14.299999999999999, 78.503), Point(14.280999999999999, 78.46), Point(14.274999999999999, 78.42), Point(14.298, 78.403), Point(14.329, 78.389), Point(14.34, 78.354), Point(14.338000000000001, 78.312), Point(14.329, 78.27499999999999), Point(14.196, 77.961), Point(14.216999999999999, 77.95400000000001), Point(14.23, 77.93900000000001), Point(14.255999999999998, 77.898), Point(14.266000000000002, 77.887), Point(14.274999999999999, 77.88199999999999), Point(14.298, 77.881), Point(14.307, 77.874), Point(14.304, 77.86), Point(14.296000000000001, 77.849), Point(14.292, 77.849), Point(14.285999999999998, 77.794), Point(14.266000000000002, 77.75999999999999), Point(14.238000000000001, 77.738), Point(14.208000000000002, 77.72200000000001), Point(14.208000000000002, 77.708), Point(14.219999999999999, 77.648), Point(14.23, 77.613), Point(14.245, 77.581), Point(14.252999999999998, 77.633), Point(14.271, 77.679), Point(14.299999999999999, 77.704), Point(14.34, 77.69200000000001), Point(14.321, 77.659), Point(14.305000000000001, 77.614), Point(14.34, 77.59700000000001), Point(14.429, 77.64999999999999), Point(14.471, 77.653), Point(14.507, 77.614), Point(14.52, 77.562), Point(14.527999999999999, 77.505), Point(14.542, 77.459), Point(14.573, 77.44), Point(14.601, 77.416), Point(14.626, 77.363), Point(14.643999999999998, 77.302), Point(14.651, 77.25999999999999), Point(14.632000000000001, 77.14), Point(14.636, 77.095), Point(14.674999999999999, 77.063), Point(14.688, 77.08), Point(14.732999999999999, 77.048), Point(14.771, 77.009), Point(14.793999999999999, 76.958), Point(14.793999999999999, 76.889), Point(14.765, 76.78399999999999), Point(14.771, 76.663), Point(14.777999999999999, 76.621), Point(14.809, 76.55999999999999), Point(14.818000000000001, 76.529), Point(14.813, 76.495), Point(14.799000000000001, 76.46), Point(14.78, 76.43299999999999), Point(14.765, 76.422), Point(14.752, 76.419), Point(14.722, 76.407), Point(14.668999999999999, 76.40400000000001), Point(14.663, 76.405), Point(14.634, 76.387), Point(14.621, 76.36800000000001), Point(14.626, 76.36), Point(14.651, 76.373), Point(14.673, 76.342), Point(14.671999999999999, 76.313), Point(14.651, 76.265), Point(14.649999999999999, 76.238), Point(14.663, 76.154), Point(14.661, 76.139), Point(14.654, 76.125), Point(14.649999999999999, 76.11), Point(14.651, 76.092), Point(14.658, 76.075), Point(14.662, 76.071), Point(14.667, 76.07000000000001), Point(14.693000000000001, 76.046), Point(14.715, 76.03), Point(14.726, 76.01), Point(14.710999999999999, 75.985), Point(14.723, 75.968), Point(14.738999999999999, 76.02600000000001), Point(14.751, 76.047), Point(14.771, 76.061), Point(14.758, 76.06), Point(14.748, 76.061), Point(14.74, 76.059), Point(14.734, 76.047), Point(14.723, 76.061), Point(14.771, 76.095), Point(14.825, 76.092), Point(14.876000000000001, 76.061), Point(14.914, 76.015), Point(14.929, 75.981), Point(14.932, 75.956), Point(14.926, 75.883), Point(14.921000000000001, 75.852), Point(14.906, 75.812), Point(14.887, 75.774), Point(14.866999999999999, 75.751), Point(14.879000000000001, 75.75800000000001), Point(14.889, 75.76899999999999), Point(14.896999999999998, 75.78200000000001), Point(14.902999999999999, 75.797), Point(14.914, 75.797), Point(14.896999999999998, 75.77000000000001), Point(14.87, 75.735), Point(14.847, 75.696), Point(14.843, 75.658), Point(14.860999999999999, 75.64), Point(14.95, 75.61099999999999), Point(14.902000000000001, 75.6), Point(14.865, 75.614), Point(14.835, 75.646), Point(14.78, 75.734), Point(14.765, 75.74600000000001), Point(14.741000000000001, 75.751), Point(14.738000000000001, 75.738), Point(14.741999999999999, 75.679), Point(14.734, 75.658), Point(14.734, 75.642), Point(14.741999999999999, 75.618), Point(14.748, 75.516), Point(14.768999999999998, 75.421), Point(14.771999999999998, 75.37700000000001), Point(14.758, 75.347), Point(14.771, 75.33), Point(14.751, 75.288), Point(14.722, 75.213), Point(14.699000000000002, 75.175), Point(14.651, 75.114), Point(14.638000000000002, 75.088), Point(14.636, 75.078), Point(14.642, 75.071), Point(14.667, 75.01100000000001), Point(14.67, 74.991), Point(14.663, 74.958), Point(14.652999999999999, 74.939), Point(14.623, 74.90299999999999), Point(14.615, 74.882), Point(14.63, 74.839), Point(14.691, 74.792), Point(14.688, 74.758), Point(14.716999999999999, 74.708), Point(14.707, 74.666), Point(14.62, 74.564), Point(14.610999999999999, 74.548), Point(14.613000000000001, 74.529), Point(14.626, 74.496), Point(14.635000000000002, 74.489), Point(14.648, 74.488), Point(14.658, 74.481), Point(14.663, 74.457), Point(14.665000000000001, 74.437), Point(14.67, 74.421), Point(14.677000000000001, 74.41), Point(14.688, 74.402), Point(14.682999999999998, 74.424), Point(14.693999999999999, 74.42800000000001), Point(14.71, 74.41799999999999), Point(14.723, 74.402), Point(14.728, 74.373), Point(14.727, 74.318), Point(14.734, 74.295), Point(14.754999999999999, 74.31), Point(14.774000000000001, 74.298), Point(14.789, 74.27), Point(14.796000000000001, 74.232), Point(14.804, 74.21799999999999), Point(14.804999999999998, 74.21), Point(14.843, 74.233), Point(14.866999999999999, 74.217), Point(14.851, 74.182), Point(14.843, 74.17), Point(14.872, 74.166), Point(14.913000000000002, 74.144), Point(14.926, 74.156), Point(14.939, 74.156), Point(14.960999999999999, 74.06), Point(14.975, 73.94), Point(15.015999999999998, 73.95), Point(15.037, 73.911), Point(15.036, 73.856), Point(15.010000000000002, 73.818), Point(15.010000000000002, 73.803), Point(15.037, 73.795), Point(15.068000000000001, 73.795), Point(15.085, 73.782), Point(15.071000000000002, 73.74000000000001), Point(15.081, 73.725), Point(15.106, 73.74000000000001), Point(15.1, 73.786), Point(15.129999999999999, 73.828), Point(15.174999999999999, 73.861), Point(15.213, 73.878), Point(15.253, 73.873), Point(15.301, 73.85000000000001), Point(15.343000000000002, 73.815), Point(15.368, 73.772), Point(15.368, 73.818), Point(15.408, 73.78), Point(15.431000000000001, 73.761), Point(15.451999999999998, 73.75500000000001), Point(15.466, 73.764), Point(15.485, 73.79599999999999), Point(15.494, 73.803), Point(15.512, 73.804), Point(15.524, 73.81), Point(15.702, 73.99), Point(15.716, 74.018), Point(15.729000000000001, 74.008), Point(15.734, 74.006), Point(15.753, 74.018), Point(15.740000000000002, 74.018), Point(15.759, 74.09700000000001), Point(15.786, 74.144), Point(15.784, 74.16), Point(15.774, 74.17200000000001), Point(15.764, 74.18599999999999), Point(15.751000000000001, 74.223), Point(15.741, 74.263), Point(15.736, 74.307), Point(15.740000000000002, 74.358), Point(15.754000000000001, 74.401), Point(15.775, 74.432), Point(15.845999999999998, 74.507), Point(15.847, 74.516), Point(15.847, 74.534), Point(15.839, 74.546), Point(15.795, 74.53699999999999), Point(15.776000000000002, 74.542), Point(15.774, 74.53999999999999), Point(15.769, 74.551), Point(15.754999999999999, 74.559), Point(15.745000000000001, 74.57000000000001), Point(15.753, 74.588), Point(15.753, 74.605), Point(15.73, 74.615), Point(15.732, 74.62299999999999), Point(15.751000000000001, 74.625), Point(15.776000000000002, 74.619), Point(15.791, 74.605), Point(15.805, 74.586), Point(15.818999999999999, 74.576), Point(15.834999999999999, 74.588), Point(15.906, 74.505), Point(15.947, 74.466), Point(15.998000000000001, 74.45), Point(16.003999999999998, 74.464), Point(16.024, 74.495), Point(16.053, 74.52600000000001), Point(16.086, 74.542), Point(16.149, 74.535), Point(16.181, 74.52499999999999), Point(16.206, 74.51), Point(16.218, 74.527), Point(16.231, 74.51100000000001), Point(16.253, 74.497), Point(16.277, 74.485), Point(16.296, 74.481), Point(16.31, 74.471), Point(16.35, 74.42699999999999), Point(16.367, 74.41799999999999), Point(16.377, 74.41), Point(16.421, 74.358), Point(16.457, 74.34100000000001), Point(16.472, 74.32900000000001), Point(16.481, 74.309), Point(16.494, 74.309), Point(16.520000000000003, 74.32600000000001), Point(16.547, 74.334), Point(16.573999999999998, 74.32900000000001), Point(16.601, 74.309), Point(16.594, 74.291), Point(16.593, 74.279), Point(16.599, 74.272), Point(16.613, 74.264), Point(16.619999999999997, 74.31), Point(16.650000000000002, 74.33), Point(16.681, 74.343), Point(16.697, 74.36500000000001), Point(16.7, 74.387), Point(16.717000000000002, 74.432), Point(16.72, 74.45), Point(16.713, 74.465), Point(16.701, 74.477), Point(16.695, 74.49), Point(16.708000000000002, 74.51), Point(16.699, 74.565), Point(16.724, 74.628), Point(16.768, 74.679), Point(16.816, 74.697), Point(16.816, 74.711), Point(16.775000000000002, 74.74199999999999), Point(16.761, 74.763), Point(16.756, 74.797), Point(16.759, 74.83), Point(16.78, 74.928), Point(16.823, 75.048), Point(16.833000000000002, 75.12), Point(16.805, 75.16000000000001), Point(16.848, 75.307), Point(16.853, 75.37), Point(16.841, 75.471), Point(16.844, 75.50099999999999), Point(16.853, 75.52499999999999), Point(16.861, 75.543), Point(16.864, 75.556), Point(16.868, 75.589), Point(16.884, 75.627), Point(16.888, 75.64999999999999), Point(16.886000000000003, 75.682), Point(16.877, 75.737), Point(16.875, 75.766), Point(16.878, 75.822), Point(16.887, 75.87899999999999), Point(16.902, 75.927), Point(16.924, 75.954), Point(16.924, 75.968), Point(16.916, 75.972), Point(16.908, 75.98), Point(16.900000000000002, 75.985), Point(16.900000000000002, 75.99900000000001), Point(16.912, 75.99900000000001), Point(16.902, 76.024), Point(16.902, 76.05), Point(16.911, 76.078), Point(16.924, 76.108), Point(16.932, 76.114), Point(16.944, 76.114), Point(16.955000000000002, 76.119), Point(16.961000000000002, 76.14), Point(16.957, 76.155), Point(16.947000000000003, 76.155), Point(16.933999999999997, 76.14800000000001), Point(16.924, 76.14), Point(16.907, 76.203), Point(16.918, 76.275), Point(16.983, 76.447), Point(16.986, 76.482), Point(16.948, 76.511), Point(16.908, 76.566), Point(16.894000000000002, 76.579), Point(16.869, 76.591), Point(16.851, 76.621), Point(16.808999999999997, 76.739), Point(16.805999999999997, 76.75999999999999), Point(16.799, 76.85600000000001), Point(16.801, 76.89200000000001), Point(16.816, 76.936), Point(16.835, 76.967), Point(16.878, 77.005), Point(16.900000000000002, 77.031), Point(16.930999999999997, 77.09700000000001), Point(16.951, 77.128), Point(16.977, 77.141), Point(17.016000000000002, 77.153), Point(17.037, 77.184), Point(17.066, 77.267), Point(17.105, 77.332), Point(17.119999999999997, 77.36699999999999), Point(17.125, 77.417), Point(17.131, 77.44), Point(17.151, 77.479), Point(17.150000000000002, 77.50200000000001), Point(17.14, 77.518)]


domain = Polygon(domain_vertices)

mesh = generate_mesh(domain, resolution)

plt.rcParams.update({
    "text.usetex": True,
    "font.family": "sans-serif",
    "font.sans-serif": ["Helvetica"]})

fig = plot(mesh, title='Sardinia discretization')
plt.grid(fig, linewidth = 0.1)
plt.xlabel('$x$')
plt.ylabel('$y$')

def boundary(x, on_boundary):
  return on_boundary

V = FunctionSpace(mesh, 'CG', degree)

bc = DirichletBC(V, g_D, boundary)

u = TrialFunction(V)
v = TestFunction(V)

a = (dot(grad(u), grad(v))) * dx
L = (f * v) * dx

u = Function(V)

solve(a == L, u, bc)

tit = 'FEniCS solution with N = {}'.format(Td)

fig = plot(u, cmap = 'jet', title = tit)
plt.grid(fig, linewidth = 0.1)
plt.colorbar(fig)
plt.xlabel('$x$')
plt.ylabel('$y$')

vtkfile = File('Velocity.pvd')
vtkfile << u

with open("FEniCSPoissonSardinia.txt", "w") as txt_file:
    for line in range(len(x_coord)):
      txt_file.write('{}, {}, {};'.format(x_coord[line], y_coord[line], u_array[line]) + "\n")
